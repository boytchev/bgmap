<!DOCTYPE html>

<html>
<head>
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<script src="./js/three.min.js"></script>
	<script src="./js/OrbitControls.js"></script>
	<!--script src="./js/TessellateModifier.js"></script-->
	<link rel="stylesheet" href="./css/bgmap.css">
</head>

<body>
	<script type="module">

		import {scene} from './init.js';
		import * as CFG from './config.js';
		import './frame.js';
		import {Map} from './map.js';

		var map = new Map( `bgmap-level-${CFG.MAP_LEVEL}.xml`, createMap3D, {roundness:25, width:CFG.MAP_WIDTH, height:CFG.MAP_HEIGHT} );


		function createMap3D( map )
		{
			var geometry = map.heightmapGeometry3D( ),
				material = new THREE.MeshPhongMaterial( {
								color: 'dimgray',
								//wireframe: true,
								//emissive: new THREE.Color('cornflowerblue'),
								//emissiveIntensity: -1,
								//flatShading: true,
							} );
							
		var material = new THREE.MeshStandardMaterial( {
							color: 'gray',
							roughness: 0.6,
							metalness: 0.9,
							emissive: 'cornflowerblue',
							emissiveIntensity: 0.2,
							polygonOffset: true,
							polygonOffsetUnits: 2,
							polygonOffsetFactor: 2,
						} );

			var country = new THREE.Mesh( geometry, material );
				country.castShadow = true;
				country.receiveShadow = true;
				//country.rotation.z = -3.14/2;
			scene.add( country );
		}
		
		function createMap( map )
		{
			
			// create the country
			var geometry = map.mapGeometry3D( 'BG' ),
				material = new THREE.MeshStandardMaterial( {
								color: 'crimson',
								roughness: 1,
								metalness: 0,
								polygonOffset: true,
								polygonOffsetUnits: 1,
								polygonOffsetFactor: 1,
							} );
							
			var country = new THREE.Mesh( geometry, material );
				country.castShadow = true;
				country.receiveShadow = true;

			scene.add( country );
			
			/*
			// create the border of the country
			var geometry = map.mapGeometry2D( 'BG' ),
				material = new THREE.MeshStandardMaterial( {color: 'black'} );

			var border = new THREE.Line( geometry, material );

			//scene.add( border );
		

			// create the provinces
			for( var name in map.regions ) if( name!='BG' )
			{
				var value = Math.random();
				//var value = 1;
				
				var geometry = map.mapGeometry3D( name ),
					material = new THREE.MeshStandardMaterial( {
									color: new THREE.Color( value, 0, 1-value ),
									roughness: 1,
									metalness: 0,
									polygonOffset: true,
									polygonOffsetUnits: 1,
									polygonOffsetFactor: 1,
								} );
								
				var province = new THREE.Mesh( geometry, material );
					province.castShadow = true;
					province.receiveShadow = true;
					province.scale.y = 3*value;
					
				scene.add( province );
				
				
				// create the border of the country
				var geometry = map.mapGeometry2D( name ),
					material = new THREE.MeshStandardMaterial( {
									color: 'black',
									transparent: true,
									opacity: 0.3,
								} );

				var border = new THREE.Line( geometry, material );
					border.scale.y = 3*value;

				scene.add( border );
			}
			*/
		}
		 
		 
	</script>
</body>
</html>


